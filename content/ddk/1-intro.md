---
title: "Implementing SmallJava"
metaTitle: "Implementing SmallJava"

---
## Project Setup

To get DDK working in the DSL instance we will eventually run, we will have to edit 2 files to make sure the correct plug-ins are added to our project:
- `MANIFEST.MF` found in the directory `org.example.smalljava` -> `META-INF`
- The `GenerateSmallJava.mwe2` file in the `src` directory where `SmallJava.xtext` is situated

For the `MANIFEST.MF`:

Replace the code in your file with the following:

```javascript
Require-Bundle: org.eclipse.xtext,
 com.avaloq.tools.ddk.xtext.generator,
 com.avaloq.tools.ddk.xtext,
 com.avaloq.tools.ddk.check.generator,
 com.avaloq.tools.ddk.xtext.scope.generator,
 com.avaloq.tools.ddk.xtext.export.generator,
 com.avaloq.tools.ddk.xtext.format.generator,
 com.avaloq.tools.ddk.typesystem,
 com.avaloq.tools.ddk.xtext.valid.generator,
 com.avaloq.tools.ddk.xtext.builder,
 org.eclipse.xtext.generator,
 org.eclipse.emf.codegen.ecore,
 org.eclipse.emf.mwe.utils,
 org.eclipse.emf.mwe2.launch,
 org.eclipse.xtext.xtext.generator,
 org.eclipse.xtext.generator,
 org.eclipse.core.resources,
 org.eclipse.xtext.ecore,
 org.eclipse.xtext.xbase,
 org.eclipse.core.runtime,
 org.eclipse.equinox.common;bundle-version="3.5.0",
 org.eclipse.emf.ecore,
 org.eclipse.xtext.xbase.lib;bundle-version="2.14.0",
 org.eclipse.osgi,
 org.antlr.runtime,
 org.eclipse.xtext.util,
 org.eclipse.emf.common,
 org.eclipse.xtend.lib;bundle-version="2.14.0",
 org.eclipse.xtend.util.stdlib,
 com.avaloq.tools.ddk.check.runtime.core
Bundle-RequiredExecutionEnvironment: JavaSE-1.8
Export-Package: org.example.smalljava,
 org.example.smalljava.smallJava,
 org.example.smalljava.smallJava.impl,
 org.example.smalljava.generator,
 org.example.smalljava.services,
 org.example.smalljava.smallJava.util,
 org.example.smalljava.parser.antlr,
 org.example.smalljava.validation,
 org.example.smalljava.parser.antlr.internal,
 org.example.smalljava.serializer,
 org.example.smalljava.scoping,
 org.example.smalljava.naming,
 org.example.smalljava.resource
Import-Package: org.apache.log4j
```



For the `GenerateSmallJava.mwe2` file, add the following starting from `Workflow`:
```javascript
Workflow {
    component = XtextGenerator {
		configuration = {
			project = StandardProjectConfig {
				baseName = "org.example.smalljava"
				rootPath = rootPath
				runtimeTest = {
					enabled = true
                }
                eclipsePlugin = {
					enabled = true
				}
				eclipsePluginTest = {
					enabled = true
				}
				createEclipseMetaData = true
            }
            code = {
				encoding = "UTF-8"
				lineDelimiter = "\n"
				fileHeader = "/*\n * generated by Xtext \n */"
			}
        }
        language = XtextGeneratorLanguage {
			name = "org.example.smalljava.SmallJava"
			fileExtensions = "smalljava"
			//serializer = {
			//	generateStub = false
			//}
			//validator = {
				// composedCheck = "org.eclipse.xtext.validation.NamesAreUniqueValidator"
			//}
			fragment = org.eclipse.xtext.xtext.generator.grammarAccess.GrammarAccessFragment2{}
			fragment = org.eclipse.xtext.xtext.generator.ecore.EMFGeneratorFragment2{}
			fragment = org.eclipse.xtext.xtext.generator.serializer.SerializerFragment2{}
			fragment = org.eclipse.xtext.xtext.generator.resourceFactory.ResourceFactoryFragment2{}
			fragment = org.eclipse.xtext.xtext.generator.parser.antlr.XtextAntlrGeneratorFragment2{}
            fragment = org.eclipse.xtext.xtext.generator.builder.BuilderIntegrationFragment2{}
            fragment = org.eclipse.xtext.xtext.generator.generator.GeneratorFragment2{}
            fragment = org.eclipse.xtext.xtext.generator.ui.labeling.LabelProviderFragment2{}
            fragment = org.eclipse.xtext.xtext.generator.ui.outline.QuickOutlineFragment2{}
            fragment = org.eclipse.xtext.xtext.generator.ui.outline.OutlineTreeProviderFragment2{}
            fragment = org.eclipse.xtext.xtext.generator.ui.quickfix.QuickfixProviderFragment2{}
            fragment = org.eclipse.xtext.xtext.generator.ui.contentAssist.ContentAssistFragment2{}
            fragment = org.eclipse.xtext.xtext.generator.junit.JUnitFragment{}
            fragment = org.eclipse.xtext.xtext.generator.ui.refactoring.RefactorElementNameFragment2{}
	
            
            //Add this fragment to make the Check Language work.
			fragment = com.avaloq.tools.ddk.check.generator.CheckValidatorFragment2{
				
			}// Add this fragment adapter and internal fragment to make the Format Language work
			fragment = org.eclipse.xtext.generator.adapter.FragmentAdapter{
				fragment = com.avaloq.tools.ddk.xtext.format.generator.FormatFragment{
					
				}
			}// Add this fragment to make the Scope Language work
			fragment = com.avaloq.tools.ddk.xtext.scope.generator.ScopingFragment2{
				
			}// Add this fragment adapter and internal fragment to make the Export Language work
			fragment = org.eclipse.xtext.generator.adapter.FragmentAdapter{
				fragment = com.avaloq.tools.ddk.xtext.export.generator.ExportFragment{
					
				}
			}
		}
	}

}
```

## Working with DDK
Once the `.mwe2` file has been edited, the correct abstract files will be auto-generated when we run it. We will now ensure the auto-generated files are generated in their own directory called `dsl-gen` to prevent conflicts with any files from Xtext.

1. Go to `Window` -> `Preferences`. We will change the output folders for the following 4 options in this window.
2. For Check: Click on `Compiler` -> `Output Folder` and change the Directory to `./dsl-gen`
3. Do the same for Format, Scope and Export.

While in Xtext the stub classes would be generated as part of running this workflow, currently for DDK you will have to create your own files for Check, Format, Export and Scope by:

1. Right-clicking on the desired directory
2. Select `New` -> `File`
3. If `File` is not an option, click on `Other..` and Select `File` from the `General` option.
4. Write your desired file name together with the desired extension (usually SmallJava followed by ther extension .export or .check or .scope or .format)

To ensure we can run the new `.mwe2` file, we will need to add the stub class for Export ourselves. In the directory `org.example.smalljava` -> `src` -> `org.example.smalljava`create a general file and name it `SmallJava.export`

We will cover Scope and Export in more detail in the following sections, for now you can add the following code as a stub class:

Smalljava.export:
```javascript
import "http://www.example.org/smalljava/SmallJava" as smalljava

interface {
    smalljava::SJClass = name;
}


export SJClass as name {
    object-fingerprint;
}
```
Now you should be able to run the `.mwe2` file which will generate the appropriate stub packages. To run it, right-click on the file and select `Run as` -> `MWE2 Workflow`. 


While implementing SmallJava, we will go through and solve the errors that have now popped up in your workspace as well.